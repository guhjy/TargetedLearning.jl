<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://targetedlearningjl.readthedocs.org/user-guide/lalonde_example/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Lalonde Example - TargetedLearning.jl</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">TargetedLearning.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../julia">Julia</a>
                        </li>
                    
                        <li >
                            <a href="../estimation">The estimation problem</a>
                        </li>
                    
                        <li >
                            <a href="../ctmle">(C)TMLE</a>
                        </li>
                    
                        <li >
                            <a href="../influencecurves">Automatic influence curves</a>
                        </li>
                    
                        <li class="active">
                            <a href=".">Lalonde Example</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../api/common">Common</a>
                        </li>
                    
                        <li >
                            <a href="../../api/lreg">LReg</a>
                        </li>
                    
                        <li >
                            <a href="../../api/parameters">Parameters</a>
                        </li>
                    
                        <li >
                            <a href="../../api/qmodels">Qmodels</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../about/license">License</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../influencecurves">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../api/common">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/lendle/TargetedLearning.jl/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#getting-the-data-set">Getting the data set</a></li>
        
    
        <li class="main "><a href="#loading-the-data-set">Loading the data set</a></li>
        
            <li><a href="#using-readcsv">Using readcsv</a></li>
        
            <li><a href="#using-dataframe">Using DataFrame</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p>Throughout the user's guide, we'll use the <a href="http://users.nber.org/~rdehejia/nswdata2.html">Lalonde dataset</a>. It is originally from
Robert Lalonde, "Evaluating the Econometric Evaluations of Training Programs," <em>American Economic Review</em>, Vol. 76, pp. 604-620. 1986.</p>
<h1 id="getting-the-data-set">Getting the data set</h1>
<p>To download the example data set, run</p>
<pre><code>include(joinpath(Pkg.dir("TargetedLearning"), "examples", "fetchdata.jl"))

INFO: /home/sam/.julia/v0.3/TargetedLearning/examples/data/lalonde.csv exists. To redownload, call fetchdata(true)
</code></pre>
<p>This only needs to be run once.</p>
<h1 id="loading-the-data-set">Loading the data set</h1>
<h2 id="using-readcsv">Using readcsv</h2>
<p>The simplest way to read the data set is with <code>readcsv</code>. The CSV file we have has a header, so we'll pass <code>header=true</code>, and we'll get back a tuple containing a matrix with the numeric data in it (<code>readcsv</code> can figure out that it's all <code>Float64</code>s automatically) and a matrix with one row containing column names.</p>
<pre><code>dsfname = joinpath(Pkg.dir("TargetedLearning"), "examples", "data", "lalonde.csv")

dat, colnames = readcsv(dsfname, header=true)

#lets inspect colnames
colnames




1x9 Array{String,2}:
 "treatment"  "age"  "education"  "black"  …  "nodegree"  "RE75"  "RE78"




#convert colnames to a vector instead of a matrix with one row
colnames = reshape(colnames, size(colnames, 2))




9-element Array{String,1}:
 "treatment"
 "age"      
 "education"
 "black"    
 "hispanic" 
 "married"  
 "nodegree" 
 "RE75"     
 "RE78"
</code></pre>
<p><code>treatment</code> is obviously the treatment variable. The outcome variable is <code>RE78</code> (earnings in 1978), and <code>RE75</code> is the pretreatment value at baseline. The others are potential baseline confounders. Check the link above for more information about the dataset.  We want to slice the matrix <code>dat</code> up to extract the treatment and outcome variable. Julia uses square brackets for indexing. The first dimension of a matrix is rows and the second is columns like R. If you want everything in one dimension, you put <code>:</code> (where as in R you can leave that dimension empty). You can index with booleans, integers, vectors of integers, ranges and some other things. Here are some examples:</p>
<pre><code>#we know column 1 is treatment, so get it directly, and ask for all rows with :
treatment = dat[:, 1]




722-element Array{Float64,1}:
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 ⋮  
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0




#suppose instead we want to find the position in colnames that has the value
#"treatment", but we don't know it's the first one. There are a couple of ways
#to do that.
#(.== and operators starting with `.` in general indicate that we want to do
#   an element wise operation)

#(the ; at the end of the line suppresses output)
treatment_take2 = dat[:, colnames .== "treatment", 1];


#the last column is the outcome so we can use the keyword `end`
outcome = dat[:, end]

#we can also use `end` in arithmetic, e.g.
outcome_prebaseline = dat[:, end-1]




722-element Array{Float64,1}:
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    0.0 
    ⋮   
    0.0 
    0.0 
 1537.93
    0.0 
 8012.09
  768.81
 1345.91
  825.23
    0.0 
 1206.44
    0.0 
    0.0




#baseline covariates are everything between the first and last column, so we could use a range:
baseline_covars = dat[:, 2:end-1]




722x7 Array{Float64,2}:
 37.0  11.0  1.0  0.0  1.0  1.0     0.0 
 22.0   9.0  0.0  1.0  0.0  1.0     0.0 
 30.0  12.0  1.0  0.0  0.0  0.0     0.0 
 27.0  11.0  1.0  0.0  0.0  1.0     0.0 
 33.0   8.0  1.0  0.0  0.0  1.0     0.0 
 22.0   9.0  1.0  0.0  0.0  1.0     0.0 
 23.0  12.0  1.0  0.0  0.0  0.0     0.0 
 32.0  11.0  1.0  0.0  0.0  1.0     0.0 
 22.0  16.0  1.0  0.0  0.0  0.0     0.0 
 33.0  12.0  0.0  0.0  1.0  0.0     0.0 
 19.0   9.0  1.0  0.0  0.0  1.0     0.0 
 21.0  13.0  1.0  0.0  0.0  0.0     0.0 
 18.0   8.0  1.0  0.0  0.0  1.0     0.0 
  ⋮                         ⋮           
 17.0  10.0  0.0  1.0  0.0  1.0     0.0 
 19.0  11.0  1.0  0.0  0.0  1.0     0.0 
 19.0   9.0  1.0  0.0  0.0  1.0  1537.93
 17.0  10.0  1.0  0.0  0.0  1.0     0.0 
 20.0  11.0  1.0  0.0  0.0  1.0  8012.09
 17.0   8.0  1.0  0.0  0.0  1.0   768.81
 18.0   8.0  0.0  0.0  0.0  1.0  1345.91
 20.0  10.0  1.0  0.0  0.0  1.0   825.23
 17.0   9.0  0.0  1.0  0.0  1.0     0.0 
 17.0   9.0  1.0  0.0  0.0  1.0  1206.44
 19.0  11.0  1.0  0.0  0.0  1.0     0.0 
 18.0  10.0  1.0  0.0  0.0  1.0     0.0
</code></pre>
<h2 id="using-dataframe">Using DataFrame</h2>
<p>The <code>readtable</code> function returns a <code>DataFrame</code> which allows for indexing by column names.</p>
<pre><code>using DataFrames #`using` is like `library` in R

dsfname = joinpath(Pkg.dir("TargetedLearning"), "examples", "data", "lalonde.csv")
"/home/sam/.julia/v0.3/TargetedLearning/examples/data/lalonde.csv"

df = readtable(dsfname)

#check the column names:
names(df)




9-element Array{Symbol,1}:
 :treatment
 :age      
 :education
 :black    
 :hispanic 
 :married  
 :nodegree 
 :RE75     
 :RE78
</code></pre>
<p>Data frames in Julia are indexed by symbols instead of strings. Symbols are no entirely unlike strings, and are created in julia with <code>:symbolname</code> or <code>Symbol("symbolname")</code>.</p>
<p>Now let's get the treatment and outcome variables out of <code>df</code>.</p>
<pre><code>treatment = df[:treatment]
outcome = df[:RE78]




722-element DataArray{Float64,1}:
  9930.05 
  3595.89 
 24909.5  
  7506.15 
   289.79 
  4056.49 
     0.0  
  8472.16 
  2164.02 
 12418.1  
  8173.91 
 17094.6  
     0.0  
     ⋮    
  8469.27 
     0.0  
  4188.74 
  1143.39 
 18155.8  
  3020.95 
  1725.59 
     0.0  
  5114.81 
     0.0  
     0.0  
   781.224
</code></pre>
<p>We see that variables in a data frame are actually <code>DataArray</code>s instead of regular Julia <code>Array</code>s. The functions in TargetedLearning.jl currently only work with <code>Arrays</code> of floating point numbers, so we'll convert them.</p>
<pre><code>treatment = convert(Array{Float64}, treatment)
outcome = convert(Array{Float64}, outcome)
typeof(outcome)




Array{Float64,1}
</code></pre>
<p>We can also index into the data frame using ranges, just like regular matrixes (but we only index on columns). Let's get the baseline covariates. When you get more than one column out of a data frame, you get back another data frame. For some reason that I do not know, <code>convert</code> won't work for us here, but <code>array</code> will get us what we need (a Julia array instead of a DataFrame).</p>
<pre><code>baseline_covars = array(df[2:end-1])




722x7 Array{Real,2}:
 37  11  1  0  1  1     0.0 
 22   9  0  1  0  1     0.0 
 30  12  1  0  0  0     0.0 
 27  11  1  0  0  1     0.0 
 33   8  1  0  0  1     0.0 
 22   9  1  0  0  1     0.0 
 23  12  1  0  0  0     0.0 
 32  11  1  0  0  1     0.0 
 22  16  1  0  0  0     0.0 
 33  12  0  0  1  0     0.0 
 19   9  1  0  0  1     0.0 
 21  13  1  0  0  0     0.0 
 18   8  1  0  0  1     0.0 
  ⋮               ⋮         
 17  10  0  1  0  1     0.0 
 19  11  1  0  0  1     0.0 
 19   9  1  0  0  1  1537.93
 17  10  1  0  0  1     0.0 
 20  11  1  0  0  1  8012.09
 17   8  1  0  0  1   768.81
 18   8  0  0  0  1  1345.91
 20  10  1  0  0  1   825.23
 17   9  0  1  0  1     0.0 
 17   9  1  0  0  1  1206.44
 19  11  1  0  0  1     0.0 
 18  10  1  0  0  1     0.0
</code></pre>
<h3 id="formulas">Formulas</h3>
<p>One nice thing about DataFrames.jl is that is has support for formulas. They are similar to R's formulas, but there are some differences. Some packages, like GLM.jl take data frames with formulas as input. Those packages can be used for computing initial estimates, but TargetedLearning.jl does not support formulas and DataFrames directly.  However, you can use DataFrames.jl's functionality to take a DataFrame and a formula and get a numeric design matrix based on a formula.</p>
<p>For example, suppose we'd like to include an age squared term and an interaction term between education and marital status. It looks like polynomial terms aren't implemented currently, so you'll have to manually make those terms.</p>
<pre><code>#create age squared
df[:age2] = df[:age] .* df[:age];

#suppress the intercept with -1
fm = treatment ~ -1 + age + age2 + education + black + hispanic + married + nodegree + RE75 + married&amp;nodegree




Formula: treatment ~ -1 + age + age2 + education + black + hispanic + married + nodegree + RE75 + married &amp; nodegree




#take the field named `m` from the created ModelMatrix object
expanded_baseline_covars = ModelMatrix(ModelFrame(fm, df)).m




722x9 Array{Float64,2}:
 37.0  1369.0  11.0  1.0  0.0  1.0  1.0     0.0   1.0
 22.0   484.0   9.0  0.0  1.0  0.0  1.0     0.0   0.0
 30.0   900.0  12.0  1.0  0.0  0.0  0.0     0.0   0.0
 27.0   729.0  11.0  1.0  0.0  0.0  1.0     0.0   0.0
 33.0  1089.0   8.0  1.0  0.0  0.0  1.0     0.0   0.0
 22.0   484.0   9.0  1.0  0.0  0.0  1.0     0.0   0.0
 23.0   529.0  12.0  1.0  0.0  0.0  0.0     0.0   0.0
 32.0  1024.0  11.0  1.0  0.0  0.0  1.0     0.0   0.0
 22.0   484.0  16.0  1.0  0.0  0.0  0.0     0.0   0.0
 33.0  1089.0  12.0  0.0  0.0  1.0  0.0     0.0   0.0
 19.0   361.0   9.0  1.0  0.0  0.0  1.0     0.0   0.0
 21.0   441.0  13.0  1.0  0.0  0.0  0.0     0.0   0.0
 18.0   324.0   8.0  1.0  0.0  0.0  1.0     0.0   0.0
  ⋮                            ⋮                     
 17.0   289.0  10.0  0.0  1.0  0.0  1.0     0.0   0.0
 19.0   361.0  11.0  1.0  0.0  0.0  1.0     0.0   0.0
 19.0   361.0   9.0  1.0  0.0  0.0  1.0  1537.93  0.0
 17.0   289.0  10.0  1.0  0.0  0.0  1.0     0.0   0.0
 20.0   400.0  11.0  1.0  0.0  0.0  1.0  8012.09  0.0
 17.0   289.0   8.0  1.0  0.0  0.0  1.0   768.81  0.0
 18.0   324.0   8.0  0.0  0.0  0.0  1.0  1345.91  0.0
 20.0   400.0  10.0  1.0  0.0  0.0  1.0   825.23  0.0
 17.0   289.0   9.0  0.0  1.0  0.0  1.0     0.0   0.0
 17.0   289.0   9.0  1.0  0.0  0.0  1.0  1206.44  0.0
 19.0   361.0  11.0  1.0  0.0  0.0  1.0     0.0   0.0
 18.0   324.0  10.0  1.0  0.0  0.0  1.0     0.0   0.0
</code></pre>
<p>It's clunky, but will get the job done. More detailed documentation is <a href="http://dataframesjl.readthedocs.org/en/latest/formulas.html">here</a>.</p>
<h3 id="missing-data-and-categorical-data">Missing data and categorical data</h3>
<p><a href="http://dataframesjl.readthedocs.org/en/latest/">DataFrames.jl</a> and <a href="https://github.com/JuliaStats/DataArrays.jl">DataArrays.jl</a> have ways of handling both missing data and categorical data. TargetedLearning.jl does not, so you'll have to deal with those issues ahead of time. The documentation for those packages has more information on both.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>